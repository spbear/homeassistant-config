script_turn_on_my_room_ac:
  alias: Turn On Samsung AC
  sequence:
  - service: remote.send_command
    entity_id: 'remote.mi_ir_controller'
    data:
      command:
      - 'turn_on_my_room_ac'

script_turn_off_my_room_ac:
  alias: Turn Off Samsung AC
  sequence:
  - service: remote.send_command
    entity_id: 'remote.mi_ir_controller'
    data:
      command:
      - 'turn_off_my_room_ac'

sonos_say:
  alias: "Sonos TTS script"
  sequence:
   - service: media_player.sonos_snapshot
     data_template:
       entity_id: "{{ sonos_entity }}"
   - service: media_player.sonos_unjoin
     data_template:
       entity_id: "{{ sonos_entity }}"
   - service: media_player.volume_set
     data_template:
       entity_id: "{{ sonos_entity }}"
       volume_level: "{{ volume }}"
   - service: tts.google_say
     data_template:
       entity_id: "{{ sonos_entity }}"
       message: "{{ message }}"
   - delay: "{{ delay }}"
   - service: media_player.sonos_restore
     data_template:
       entity_id: "{{ sonos_entity }}"

# START XIAOMI SIREN
xiaomi_alarm_siren:
  alias: Start Xiaomi Alarm Siren
  sequence:
    - service: xiaomi_aqara.play_ringtone
      data_template:
        ringtone_id: 2
        ringtone_vol: 10
        gw_mac: !secret gateway_mac
    - delay:
        seconds: 6.5
    - service: script.turn_on
      data:
        entity_id: script.xiaomi_alarm_siren_loop

# LOOP BACK TO START SIREN AGAIN
xiaomi_alarm_siren_loop:
  alias: Xiaomi Alarm Siren Loop
  sequence:
    - delay:
### time for siren to start
        seconds: .1
    - service: script.turn_on
      data:
        entity_id: script.xiaomi_alarm_siren

# CANCEL Siren when Disarm - refer to Automation
xiaomi_alarm_siren_stop:
  alias: Stop Xiaomi Alarm Siren
  sequence:
    - delay:
        seconds: 1
    - service: script.turn_off
      data:
        entity_id: script.xiaomi_alarm_siren
    - service: script.turn_off
      data:
        entity_id: script.xiaomi_alarm_siren_loop
    - service: xiaomi_aqara.stop_ringtone
      data_template:
        gw_mac: !secret gateway_mac

xiaomi_alarm_light:
  alias: Start Xiaomi Alarm Light
  sequence:
    - service: light.turn_on
      data:
        entity_id: light.gateway_light
        color_name: blue
        brightness_pct: 100
    - delay:
        seconds: 0.3
    - service: light.turn_on
      data:
        entity_id: light.gateway_light
        color_name: red
        brightness_pct: 100
    - delay:
        seconds: 0.2
    - service: script.turn_on
      data:
        entity_id: script.xiaomi_alarm_light_loop

xiaomi_alarm_light_loop:
  alias: Xiaomi Alarm Light Loop
  sequence:
    - delay:
### time for siren to start
        seconds: .1
    - service: script.turn_on
      data:
        entity_id: script.xiaomi_alarm_light

xiaomi_alarm_light_stop:
  alias: Stop Xiaomi Alarm Siren
  sequence:
    - delay:
        seconds: 1
    - service: script.turn_off
      data:
        entity_id: script.xiaomi_alarm_light
    - service: script.turn_off
      data:
        entity_id: script.xiaomi_alarm_light_loop
    - service: light.turn_off
      data:
        entity_id: light.gateway_light

xiaomi_alarm_alert:
  alias: Xiaomi Alarm Alert
  sequence:
    - service: script.turn_on
      data:
        entity_id: script.xiaomi_alarm_light
    - service: script.turn_on
      data:
        entity_id: script.xiaomi_alarm_siren
    - delay:
        seconds: 20
    - service: script.turn_on
      data:
        entity_id: script.xiaomi_alarm_siren_stop
    - service: script.turn_on
      data:
        entity_id: script.xiaomi_alarm_light_stop
