sonos_say:
  alias: "Sonos TTS script"
  sequence:
   - service: media_player.sonos_snapshot
     data_template:
       entity_id: "{{ sonos_entity }}"
   - service: media_player.sonos_unjoin
     data_template:
       entity_id: "{{ sonos_entity }}"
   - service: media_player.volume_set
     data_template:
       entity_id: "{{ sonos_entity }}"
       volume_level: "{{ volume }}"
   - service: tts.google_say
     data_template:
       entity_id: "{{ sonos_entity }}"
       message: "{{ message }}"
   - delay: "{{ delay }}"
   - service: media_player.sonos_restore
     data_template:
       entity_id: "{{ sonos_entity }}"

sonos_stop:
  alias: "Stop Sonos"
  sequence:
  - service: switch.turn_off
    data:
      entity_id: switch.music_auto_play
  - service_template: media_player.media_play_pause
    data_template:
      entity_id: media_player.playroom
  - service: script.xiaomi_alarm_alert_stop

sonos_play_random:
  alias: Play random song
  sequence:
    - service: mqtt.publish
      data_template:
        topic: "sonos/playlist"
        payload: "{{ ['bank0', 'bank1','bank2', 'bank3','bank4', 'bank5', 'bank6'] | random }}"
        retain: "true"
    - service: switch.turn_on
      data:
        entity_id: switch.music_auto_play
    - service: media_player.volume_set
      data_template:
        entity_id: media_player.playroom
        volume_level: 0.12
    - service: media_player.shuffle_set
      data:
        entity_id: media_player.playroom
        shuffle: true
    - service: media_player.select_source
      data_template:
        entity_id: media_player.playroom
        source: >
          {{ states('sensor.sonos_playlist') }}
    - service: media_player.media_next_track
      data:
        entity_id: media_player.playroom

sonos_play_sleep_song:
  alias: Play sleep song
  sequence:
    - service: mqtt.publish
      data_template:
        topic: "sonos/playlist"
        payload: "{{ ['sleep'] | random }}"
        retain: "true"
    - service: switch.turn_on
      data:
        entity_id: switch.music_auto_play
    - service: media_player.volume_set
      data_template:
        entity_id: media_player.playroom
        volume_level: 0.10
    - service: media_player.select_source
      data_template:
        entity_id: media_player.playroom
        source: >
          {{ states('sensor.sonos_playlist') }}
    - service: media_player.shuffle_set
      data:
        entity_id: media_player.playroom
        shuffle: true
    - service: media_player.media_next_track
      data:
        entity_id: media_player.playroom
